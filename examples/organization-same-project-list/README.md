# Onboarding an Organization with Infrastructure in Each Project Using a Project List Example

---

## Overview

This example demonstrates how to onboard a Google Cloud Platform (GCP) organization for Aqua Security integration. It creates necessary infrastructure resources within each specified GCP project (`projects_list` local), and it creates the necessary infrastructure resources.

## Pre-requisites

Before running this example, ensure that you have the following:

1. Terraform installed (version 1.6.4 or later).
2. `gcloud` CLI installed and configured.
3. Aqua Security account API credentials.
4. Appropriate permissions to manage resources at the organization level and within the specified projects.

## Usage

1. Obtain the Terraform configuration file generated by the Aqua platform.
2. Important: Replace `<aqua_api_key>` and `<aqua_api_secret>` with your generated API credentials.
3. Modify the `projects_list` local in the Terraform configuration to include the list of GCP project IDs you want to onboard, e.g.: `projects_list = ["my-project-id-1", "my-project-id-2"]`.
4. Run `terraform init` to initialize the Terraform working directory.
5. Run `terraform apply` to create the resources.

## What's Happening

1. The `aqua_gcp_onboarding` module is called for each GCP project specified in the `projects_list` variable to provision the necessary resources (service accounts, roles, networking, etc.).
2. The `aqua_gcp_project_attachment` module is called for each specified GCP project to create the required IAM resources and trigger the Aqua API to onboard the project.

## Outputs

- `onboarding_status`: The output from the `aqua_gcp_project_attachment` module, displaying the result of the onboarding process for each project.

## Cleanup

To remove the resources created by this example, including the organization-level resources and project-specific resources, run `terraform destroy`.