# GCP Multi-Project Onboarding Example

---

## Overview

This example demonstrates how to onboard multiple existing Google Cloud Platform (GCP) projects to Aqua Security. It creates a dedicated project for provisioning Aqua resources and then attaches the existing projects to the dedicated project for Aqua Security integration.

## Pre-requisites

Before running this example, ensure that you have the following:

1. Terraform installed (version 1.6.4 or later).
2. `gcloud` CLI installed and configured.
3. Aqua Security account API credentials.

## Usage

1. Obtain the Terraform configuration file generated by the Aqua Security UI. This file will have most of the required values pre-filled, except for the API key and secret.
2. Important: Replace `<aqua_api_key>` and `<aqua_api_secret>` with your generated API credentials.
3. Run `terraform init` to initialize the Terraform working directory.
4. Run `terraform apply` to create the resources.

## What's Happening

1. The `aqua_gcp_dedicated_project` module is called to create a dedicated GCP project with the name `aqua-agentless-<tenant_id>-<org_hash>`, where `org_hash` is the first six characters of the SHA1 hash of your organization name.
2. The `aqua_gcp_onboarding` module is called to provision the necessary resources (service accounts, roles, networking, etc.) in the dedicated GCP project.
3. The `aqua_gcp_project_attachment` module is called to create the required IAM resources in the existing project and trigger the Aqua API to onboard the project.
5. The `aqua_gcp_additional_project_attachment` module is called to create the required IAM resources in the additional project (`my-additional-project-id`) and trigger the Aqua API to onboard the project.

## Outputs

- `onboarding_status`: The output from the `aqua_gcp_project_attachment` module, displaying the result of the onboarding process for the project `<project_id>`.
- `additional_project_onboarding_status`: The output from the `aqua_gcp_additional_project_attachment` module, displaying the result of the onboarding process for the project `my-additional-project-id`.

## Cleanup

To remove the dedicated project and all associated resources created by this example, run `terraform destroy`.